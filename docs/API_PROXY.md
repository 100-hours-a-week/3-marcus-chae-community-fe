# API ë° í”„ë¡ì‹œ êµ¬ì¡°

## ğŸ”„ API ì²˜ë¦¬ íë¦„

### ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë¸Œë¼ìš°ì € (localhost:3000)                  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  1. auth.service.js                                â”‚      â”‚
â”‚  â”‚     signup({ email, password, nickname })          â”‚      â”‚
â”‚  â”‚                                                     â”‚      â”‚
â”‚  â”‚  2. api.service.js                                 â”‚      â”‚
â”‚  â”‚     post('/users', data)                           â”‚      â”‚
â”‚  â”‚     â†’ fetch('/api/v1/users', ...)                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP Request
                           â”‚ POST /api/v1/users
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Express Server (server.js) :3000                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Static File Serving                               â”‚      â”‚
â”‚  â”‚  app.use(express.static('public'))                 â”‚      â”‚
â”‚  â”‚  â†’ HTML, CSS, JS íŒŒì¼ ì œê³µ                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  API Proxy Middleware                              â”‚      â”‚
â”‚  â”‚  app.use('/api', createProxyMiddleware({           â”‚      â”‚
â”‚  â”‚    target: 'http://localhost:8080',                â”‚      â”‚
â”‚  â”‚    changeOrigin: true                              â”‚      â”‚
â”‚  â”‚  }))                                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Proxy Forward
                           â”‚ POST http://localhost:8080/api/v1/users
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë°±ì—”ë“œ API Server :8080                          â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Route Handler                                     â”‚      â”‚
â”‚  â”‚  POST /api/v1/users                                â”‚      â”‚
â”‚  â”‚                                                     â”‚      â”‚
â”‚  â”‚  Business Logic:                                   â”‚      â”‚
â”‚  â”‚  - ë°ì´í„° ê²€ì¦                                      â”‚      â”‚
â”‚  â”‚  - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”                                  â”‚      â”‚
â”‚  â”‚  - DB ì €ì¥                                          â”‚      â”‚
â”‚  â”‚  - í† í° ìƒì„±                                        â”‚      â”‚
â”‚  â”‚                                                     â”‚      â”‚
â”‚  â”‚  Response:                                         â”‚      â”‚
â”‚  â”‚  { token: '...', user: { ... } }                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ìƒì„¸ ì„¤ëª…

### 1. í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ (ë¸Œë¼ìš°ì €)

**íŒŒì¼ ìœ„ì¹˜**: `public/js/services/`

#### api.service.js - HTTP ìš”ì²­ ì¶”ìƒí™”
```javascript
const API_BASE_URL = '/api/v1';  // ìƒëŒ€ ê²½ë¡œ!

export async function post(endpoint, data) {
    const url = `${API_BASE_URL}${endpoint}`;
    // ì‹¤ì œ ìš”ì²­: http://localhost:3000/api/v1/users
    const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    
    return new ApiResponse(response);
}
```

**ì—­í• **:
- HTTP ë©”ì„œë“œ ë˜í•‘ (GET, POST, PUT, DELETE)
- ê³µí†µ í—¤ë” ê´€ë¦¬
- ì—ëŸ¬ í•¸ë“¤ë§ í‘œì¤€í™”
- ì‘ë‹µ ë°ì´í„° íŒŒì‹±

#### auth.service.js - ì¸ì¦ API
```javascript
export async function signup(userData) {
    const response = await post('/users', userData);
    
    if (response.success) {
        // í† í° ì €ì¥
        authStorage.setToken(response.data.token);
    }
    
    return response;
}
```

**ì—­í• **:
- ì¸ì¦ ê´€ë ¨ API í˜¸ì¶œ
- í† í° ê´€ë¦¬
- ì‚¬ìš©ì ì •ë³´ ìºì‹±

### 2. í”„ë¡ì‹œ ì„œë²„ (Express)

**íŒŒì¼**: `server.js`

#### ì •ì  íŒŒì¼ ì„œë¹™
```javascript
app.use(express.static("public"));
```
- HTML, CSS, JS íŒŒì¼ ì œê³µ
- ì´ë¯¸ì§€, í°íŠ¸ ë“± ìì‚° ì œê³µ

#### API í”„ë¡ì‹œ
```javascript
app.use('/api', createProxyMiddleware({
    target: process.env.API_TARGET || 'http://localhost:8080',
    changeOrigin: true,
    onProxyReq: (proxyReq, req, res) => {
        console.log(`[Proxy] ${req.method} ${req.path}`);
    }
}))
```

**ì—­í• **:
- `/api`ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì„ ë°±ì—”ë“œë¡œ ì „ë‹¬
- CORS ë¬¸ì œ í•´ê²°
- ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- ì—ëŸ¬ í•¸ë“¤ë§

## ğŸ” ìš”ì²­ ê²½ë¡œ ë³€í™˜

### í´ë¼ì´ì–¸íŠ¸ â†’ Express
```
ë¸Œë¼ìš°ì € ìš”ì²­: fetch('/api/v1/users')
ì‹¤ì œ URL:     http://localhost:3000/api/v1/users
```

### Express â†’ ë°±ì—”ë“œ
```
í”„ë¡ì‹œ ì¸ì‹:   /api ë¡œ ì‹œì‘
íƒ€ê²Ÿ ì„¤ì •:     http://localhost:8080
ìµœì¢… ì „ë‹¬:     http://localhost:8080/api/v1/users
```

## ğŸŒ í™˜ê²½ë³„ ì„¤ì •

### ê°œë°œ í™˜ê²½ (.env)
```bash
PORT=3000
API_TARGET=http://localhost:8080
NODE_ENV=development
```

### í”„ë¡œë•ì…˜ í™˜ê²½
```bash
PORT=80
API_TARGET=https://api.production.com
NODE_ENV=production
```

## ğŸš« CORSë€? ì™œ í”„ë¡ì‹œê°€ í•„ìš”í• ê¹Œ?

### CORS (Cross-Origin Resource Sharing)

ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ, ë‹¤ë¥¸ ì¶œì²˜(Origin)ì˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì„ ì œí•œí•©ë‹ˆë‹¤.

**Origin = Protocol + Domain + Port**

```
http://localhost:3000  (í”„ë¡ íŠ¸ì—”ë“œ)
  â†“ ì§ì ‘ ìš”ì²­ ì‹œë„
http://localhost:8080  (ë°±ì—”ë“œ)

â†’ Originì´ ë‹¤ë¦„! â†’ CORS ì—ëŸ¬ ğŸš«
```

### í”„ë¡ì‹œ ì†”ë£¨ì…˜

```
http://localhost:3000  (ë¸Œë¼ìš°ì €)
  â†“ ê°™ì€ Origin ìš”ì²­
http://localhost:3000/api  (í”„ë¡ì‹œ)
  â†“ ì„œë²„ ê°„ í†µì‹  (CORS ì œì•½ ì—†ìŒ)
http://localhost:8080/api  (ë°±ì—”ë“œ)

â†’ ë¸Œë¼ìš°ì €ëŠ” ê°™ì€ Origin â†’ OK! âœ…
```

## ğŸ” í”„ë¡ì‹œì˜ ì¶”ê°€ ì´ì 

### 1. ë³´ì•ˆ
- ë°±ì—”ë“œ ì£¼ì†Œ ìˆ¨ê¸°ê¸°
- API í‚¤ë¥¼ ì„œë²„ì—ì„œ ì¶”ê°€ ê°€ëŠ¥
- ìš”ì²­ í•„í„°ë§/ê²€ì¦

### 2. ìœ ì—°ì„±
- ë°±ì—”ë“œ ì£¼ì†Œ ë³€ê²½ ì‹œ server.jsë§Œ ìˆ˜ì •
- ë¡œë“œ ë°¸ëŸ°ì‹± ê°€ëŠ¥
- ì—¬ëŸ¬ ë°±ì—”ë“œ ì„œë²„ ë¼ìš°íŒ…

### 3. ê°œë°œ í¸ì˜ì„±
- í•˜ë‚˜ì˜ í¬íŠ¸ë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì ‘ê·¼
- CORS ì„¤ì • ë¶ˆí•„ìš”
- ë¡œì»¬ ê°œë°œ í™˜ê²½ ë‹¨ìˆœí™”

## ğŸ“Š ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### íšŒì›ê°€ì… í”Œë¡œìš°

```javascript
// 1. ì‚¬ìš©ìê°€ í¼ ì œì¶œ
// public/js/pages/signup.page.js
async handleSignup() {
    const userData = {
        email: 'user@example.com',
        password: 'Password123!',
        nickname: 'í™ê¸¸ë™'
    };
    
    // 2. ì„œë¹„ìŠ¤ ë ˆì´ì–´ í˜¸ì¶œ
    const response = await signup(userData);
    
    if (response.success) {
        navigateTo(ROUTES.LOGIN);
    }
}

// 3. auth.service.js
export async function signup(userData) {
    return await post('/users', userData);
}

// 4. api.service.js
export async function post(endpoint, data) {
    const response = await fetch('/api/v1' + endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    return new ApiResponse(response);
}

// 5. ë¸Œë¼ìš°ì €
// â†’ http://localhost:3000/api/v1/users

// 6. Express server.js (í”„ë¡ì‹œ)
// â†’ http://localhost:8080/api/v1/users

// 7. ë°±ì—”ë“œ API
// â†’ ë°ì´í„° ì²˜ë¦¬ ë° ì‘ë‹µ
```

## ğŸ› ï¸ ë””ë²„ê¹… íŒ

### 1. í”„ë¡ì‹œ ë¡œê·¸ í™•ì¸
```javascript
// server.jsì—ì„œ ì´ë¯¸ ì„¤ì •ë¨
onProxyReq: (proxyReq, req, res) => {
    console.log(`[Proxy] ${req.method} ${req.path}`);
}
```

### 2. ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸
- Chrome DevTools â†’ Network
- ìš”ì²­ URL í™•ì¸
- ì‘ë‹µ ìƒíƒœ ì½”ë“œ í™•ì¸

### 3. ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸
```bash
# ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
curl http://localhost:8080/api/v1/health
```

## ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” Nginxë‚˜ ë‹¤ë¥¸ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```nginx
# Nginx ì„¤ì • ì˜ˆì‹œ
server {
    listen 80;
    
    # ì •ì  íŒŒì¼
    location / {
        root /var/www/community_fe/public;
        try_files $uri $uri/ /index.html;
    }
    
    # API í”„ë¡ì‹œ
    location /api {
        proxy_pass http://backend-server:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```
